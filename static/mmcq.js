/* esm.sh - esbuild bundle(mmcq.js@1.4.0) es2022 production */
var u=class b{r;g;b;static compose(e,t){let r=e.r>>8-t,o=e.g>>8-t,s=e.b>>8-t;return(r<<2*t)+(o<<t)+s}static delta(e,t){return Math.abs(e.r-t.r)**2+Math.abs(e.g-t.g)**2+Math.abs(e.b-t.b)**2}static formHex(e){let t=W(e.toString(16).padStart(6,"0"));return new b(t.r,t.g,t.b)}constructor(e=0,t=0,r=0){this.r=e,this.g=t,this.b=r}get hex(){return"#"+this.toString()}get rgb(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toString(){return this.r.toString(16)+this.g.toString(16)+this.b.toString(16)}delta(e){return b.delta(this,e)}compose(e){return b.compose(this,e)}};function W(n){let e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return{r:parseInt(e?.[1]||"0",16),g:parseInt(e?.[2]||"0",16),b:parseInt(e?.[3]||"0",16)}}var D=class f{#e=new Map;#n=0;#t;constructor(e,t,r=0){this.#t=e,t&&(this.#e=t,this.#n=r)}static fromColors(e,t){if(!e)return new f(t);let r=new Map;return e.forEach(o=>{let s=o.compose(t);if(r.has(s)){let i=r.get(s);i.num+=1}else r.set(s,{num:1,color:o})}),new f(t,r,e.length)}get size(){return this.#n}mainColor(){let e={r:0,g:0,b:0};for(let t of this.#e.values())e.r+=t.num*t.color.r,e.g+=t.num*t.color.g,e.b+=t.num*t.color.b;return e.r=e.r/this.size,e.g=e.g/this.size,e.b=e.b/this.size,new u(e.r,e.g,e.b)}deltaDimension(){let e="b",t=new u(0,0,0),r=new u(255,255,255),o=["r","g","b"];for(let i of this.#e.values())o.forEach(a=>{t[a]=Math.max(t[a],i.color[a]),r[a]=Math.min(r[a],i.color[a])});let s=new u;return s.r=t.r-r.r,s.g=t.g-r.g,s.b=t.b-r.b,e=s.r>=s.g&&s.r>=s.b?"r":s.g>=s.r&&s.g>=s.b?"g":"b",{dimension:e,middle:(t[e]+r[e])/2}}cutWithDimension(){let{dimension:e,middle:t}=this.deltaDimension(),r={size:0,pixels:new Map},o={size:0,pixels:new Map};for(let s of this.#e.values()){let i=s.color.compose(this.#t),a=s.color[e]>t?o:r;if(a.size+=s.num,a.pixels.has(i)){let p=a.pixels.get(i);p.num+=s.num}else a.pixels.set(i,s)}return{right:new f(this.#t,o.pixels,o.size),left:new f(this.#t,r.pixels,r.size)}}},S=class{volumes=[];pixels=[];#e;constructor(n,e){this.#e=e;for(let r=0;r<n.length;r+=4){let o=new u(n[r],n[r+1],n[r+2]);this.pixels.push(o)}let t=D.fromColors(this.pixels,this.#e);this.volumes=[t]}getPalette(n){for(;this.volumes.length<n;){let t=[];for(let r=0,o=this.volumes.length;r<o;r++){let s=this.volumes[r],{left:i,right:a}=s.cutWithDimension();i.size!==0&&t.push(i),a.size!==0&&t.push(a)}if(t.length===this.volumes.length){console.warn("too small pixels");break}this.volumes=t.sort((r,o)=>o.size-r.size)}let e=this.volumes.slice(0,n).map(t=>t.mainColor());return this.getSimilarPalette(e)}getSimilarPalette(n){let e=n.length,t=new Array(e);for(let r=0;r<e;r++)t[r]={delta:255**2*3,color:new u};return this.pixels.forEach(r=>{for(let o=0;o<e;o++){let s=t[o],i=u.delta(r,n[o]);i<s.delta&&(s.delta=i,s.color=r)}}),t.map(r=>r.color)}},c,l=new Array(128).fill(void 0);l.push(void 0,null,!0,!1);function v(n){return l[n]}var g=l.length;function C(n){n<132||(l[n]=g,g=n)}function w(n){let e=v(n);return C(n),e}function y(n){g===l.length&&l.push(l.length+1);let e=g;return g=l[e],l[e]=n,e}var x=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&x.decode();var m=null;function M(){return(m===null||m.byteLength===0)&&(m=new Uint8Array(c.memory.buffer)),m}function O(n,e){return n=n>>>0,x.decode(M().subarray(n,n+e))}var z=0;function q(n,e){let t=e(n.length*1,1)>>>0;return M().set(n,t/1),z=n.length,t}var h=null;function d(){return(h===null||h.byteLength===0)&&(h=new Int32Array(c.memory.buffer)),h}function R(n,e,t){try{let i=c.__wbindgen_add_to_stack_pointer(-16),a=q(n,c.__wbindgen_malloc),p=z;c.mmcq(i,a,p,e,t);var r=d()[i/4+0],o=d()[i/4+1],s=d()[i/4+2];if(s)throw w(o);return w(r)}finally{c.__wbindgen_add_to_stack_pointer(16)}}async function T(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}let t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{let t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function E(){let n={};return n.wbg={},n.wbg.__wbindgen_object_drop_ref=function(e){w(e)},n.wbg.__wbindgen_number_new=function(e){return y(e)},n.wbg.__wbg_new_898a68150f225f2e=function(){let e=new Array;return y(e)},n.wbg.__wbg_set_502d29070ea18557=function(e,t,r){v(e)[t>>>0]=w(r)},n.wbg.__wbindgen_throw=function(e,t){throw new Error(O(e,t))},n}function I(n,e){return c=n.exports,A.__wbindgen_wasm_module=e,h=null,m=null,c}async function A(n){if(c!==void 0)return c;typeof n>"u"&&(n=new URL("mmcq_bg.wasm",import.meta.url));let e=E();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));let{instance:t,module:r}=await T(await n,e);return I(t,r)}var j=A,_;async function L(){_=import("/v135/mmcq.js@1.4.0/es2022/dist/mmcq_bg-CUYTTGJU.js").then(n=>j(n.default)).then(()=>{})}async function U(n,e){return _||L(),await _,await R(n,e.count,e.colorDepth)}async function k(n,e={}){let r=Object.assign({count:8,colorDepth:5,useWebAssembly:!1},e);return r.colorDepth=r.algorithm||r.colorDepth,r.useWebAssembly?(await U(n,r)).map(s=>u.formHex(s)):new S(n,r.colorDepth).getPalette(r.count)}export{u as Color,k as mmcq,L as preloadWasm};
//# sourceMappingURL=mmcq.mjs.map